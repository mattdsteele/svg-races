<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
    <style>
      .chart rect {
        fill: steelblue;
      }
    </style>
  </head>
  <body>
  </body>
  <script>
    var width=800;
    var height=400;
    d3.csv('2011-eldorado-race.csv', function(data) {

      var histogram = d3.layout.histogram();
      data = data.map(function(x) { return x.age; });

      data = histogram(data);

      var x = d3.scale.ordinal()
      .domain(data.map(function(d) { return d.x; }))
      .rangeBands([0,width], 0.1);

      var y = d3.scale.linear()
      .domain([0, d3.max(data, function(d) { return d.y; })])
      .range([height, 0 ]);

      var svg = d3.select('body').append('svg')
      .attr('class', 'chart')
      .attr('width', width)
      .attr('height',height);

      svg.selectAll('rect')
      .data(data)
      .enter()
      .append('rect')
      .attr('width', x.rangeBand())
      .attr('x', function(d) { return x(d.x); })
      .attr('y', function(d) { return y(d.y); })
      .attr('height', function(d) { return y.range()[0] - y(d.y); })
      .order();

      svg.selectAll('text.datalabel')
      .data(data)
      .enter()
      .append('svg:text')
      .attr('x', function(d,i) { return x(d.x); })
      .attr('y', function(d,i) { return y(d.y); })
      .attr('dx', x.rangeBand() / 2)
      .attr('dy', '1.2em')
      .attr('text-anchor', 'middle')
      .attr('fill', 'white')
      .text(function(d) { return d.length; })
      .attr('class', 'datalabel');
    });
  </script>
</html>
